{# @var craft \craft\web\twig\variables\CraftVariable #}
{#
/**
 * Code Field plugin for Craft CMS
 *
 * Code Field Input
 *
 * @author    nystudio107
 * @copyright Copyright (c) 2022 nystudio107
 * @link      https://nystudio107.com
 * @package   CodeField
 * @since     3.0.0
 */
#}

{% import "_includes/forms" as forms %}
{% import "codeeditor/codeEditor" as codeEditor %}

{% set config = {
    id: id ?? field.getInputId(),
    describedBy: field.describedBy,
    name: name,
    value: value,
    placeholder: field.placeholder ?? "",
    required: field.required,
    orientation: orientation ?? null,
} %}

{# Monaco Editor options #}
{% set monacoOptions = {
    theme: field.theme,
    language: field.language,
    fontSize: field.fontSize,
} %}
{% if not field.singleLineEditor %}
    {% if field.lineNumbers %}
        {% set monacoOptions = monacoOptions | merge({
            lineNumbers: 'on',
            lineDecorationsWidth: 6,
        }) %}
    {% endif %}
    {% if field.codeFolding %}
        {% set monacoOptions = monacoOptions | merge({
            folding: true,
        }) %}
    {% endif %}
{% endif %}
{% set monacoOptions = monacoOptions | merge(monacoOptionsOverride) %}
{# Code Editor options #}
{% set codeEditorOptions = {
    wrapperClass: "monaco-editor-background-frame",
    singleLineEditor: field.singleLineEditor,
} %}
{% if field.singleLineEditor %}
    {{ codeEditor.textField(config, "CodeEditor", monacoOptions, codeEditorOptions) }}
{% else %}
    {{ codeEditor.textareaField(config, "CodeEditor", monacoOptions, codeEditorOptions) }}
{% endif %}

{% if displayLanguages | length %}
    {% set languageSwitcherId = config.id ~ "-language-switcher" %}
    {{ forms.selectField({
        id: languageSwitcherId,
        label: "Language"|t("codefield"),
        value: field.language,
        options: displayLanguages,
    }) }}
    {% js %}
    var elementId = '{{ config.id | namespaceInputId }}';
    var switchId = '{{ languageSwitcherId | namespaceInputId }}';
    $('#' + switchId).on('change', function () {
      var language = $(this).val();
      var editor = monacoEditorInstances[elementId];
      setMonacoEditorLanguage(editor, language, elementId);
    });
    {% endjs %}
{% endif %}
